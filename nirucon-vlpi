#!/bin/bash

# Nirucon-VLPI: Post Install script for Void Linux
# Author: Nicklas Rudolfsson
# Version: 2024-08-03
# License: Feel free to use and modify, donate if you want :) https://www.paypal.com/paypalme/nicklasrudolfsson
# Disclaimer: I do not have any responsibility at all for this script and changes on your system!

# Function: Check for internet connection
check_internet_connection() {
    if ping -q -c 1 -W 1 google.com >/dev/null; then
        echo -e "\e[32mInternet connection: OK\e[0m"
    else
        echo -e "\e[31mInternet connection: DOWN\e[0m"
        echo "This script requires an active internet connection. Please resolve the issue and run the script again."
        exit 1
    fi
}

# Function: Display welcome message
display_welcome() {
    clear
    echo -e "\e[1;34mWelcome to the Nirucon-VLPI Post Install script for Void Linux\e[0m"
    echo -e "\e[1;31mDisclaimer: Use at your own risk. The author does not have any responsibility at all for this script and changes on your system!\e[0m"
    echo "--------------------------------------------------------------------------"
}

# Function: Prompt confirmation to proceed
confirm_proceed() {
    read -p "Are you sure you want to continue with the post installation on your Void Linux? [Y/n]: " confirm_install
    confirm_install="${confirm_install,,}" # Convert to lowercase
    if [[ "$confirm_install" == "n" ]]; then
        echo "Installation aborted."
        exit 0
    fi
    echo "Proceeding with installation..."
}

# Function: Prompt for reboot
prompt_reboot() {
    read -p "Nirucon-VOIDPI is now installed. Start with: startx, but it's highly recommended to reboot. Do you want to reboot now? [Y/n]: " reboot_choice
    reboot_choice="${reboot_choice,,}"
    if [[ "$reboot_choice" =~ ^(yes|y| ) ]] || [[ -z "$reboot_choice" ]]; then
        sudo reboot
    fi
}

# Function: Install repos
install_repos() {
    echo "Adding nonfree repository and installing necessary tools..."

    # Update package list and install nonfree repository
    sudo xbps-install -Syu
    sudo xbps-install -y void-repo-nonfree

    echo "Nonfree repository and tools installed successfully."

    # Uncomment the following lines to add more usable Void Linux repositories
    # add_more_repos
}

# Sub-function to add more repositories
# add_more_repos() {
#     echo "Adding additional repositories..."
#     sudo tee /etc/xbps.d/10-repository.conf <<EOF
# repository=https://repo-us.voidlinux.org/current
# repository=https://repo-us.voidlinux.org/current/multilib
# repository=https://repo-us.voidlinux.org/current/multilib/nonfree
# repository=https://repo-us.voidlinux.org/current/nonfree
# repository=https://repo-us.voidlinux.org/current/debug
# EOF
#     echo "Additional repositories added successfully."
# }

# Function: Install core dependencies for suckless (dwm, st, dmenu, slock) and minimal Xorg setup
install_core_suckless() {
    echo "Installing core dependencies for suckless and minimal Xorg setup..."

    # Update package list and install core dependencies
    sudo xbps-install -Syu
    sudo xbps-install -y base-devel libX11-devel libXft-devel libXinerama-devel \
                         freetype-devel fontconfig-devel xorg-server xinit \
                         xsetroot xorg-fonts-type1 xorg-fonts-misc wget

    echo -e "\e[32mCore dependencies for suckless and minimal Xorg setup installed successfully!\e[0m"
}

# Main function
main() {
    display_welcome
    check_internet_connection
    confirm_proceed
    install_repos
    install_core_suckless
    # Add additional functions here as needed
    prompt_reboot
}

# Run the main function
main
